  SearchDefinitions:
   moduleName: impactemailer
   summary: Weekly impact emailer cron
   version: 1.0.0
   definitions:
   - name: stateWideData
     query: 
      baseQuery: select array_to_json(array_agg(row_to_json(stateWideReports))) from ((SELECT (SELECT count(*) FROM ((SELECT DISTINCT tenantid FROM eg_pt_property WHERE (createdtime/1000) <= (extract(epoch from NOW())) AND tenantid != 'pb.testing') UNION (SELECT DISTINCT tenantid FROM eg_tl_tradelicense WHERE (createdtime/1000) <= (extract(epoch from NOW())) AND tenantid != 'pb.testing') UNION (SELECT DISTINCT tenantid FROM eg_pgr_service WHERE (createdtime/1000) <= (extract(epoch from NOW())) AND tenantid != 'pb.testing') UNION (SELECT DISTINCT tenantid FROM eg_fn_firenoc WHERE (createdtime/1000) <= (extract(epoch from NOW())) AND tenantid != 'pb.testing')) AS tenants) as ulbCovered,(SELECT TRUNC((SELECT SUM(payment.totalamountpaid) FROM egcl_payment payment INNER JOIN egcl_paymentdetail paymentdetail ON payment.id = paymentdetail.paymentid INNER JOIN egcl_bill bill ON paymentdetail.billid =bill.id WHERE (paymentdetail.receiptdate/1000) <= (extract(epoch from NOW())) AND payment.tenantid != 'pb.testing' AND payment.paymentstatus != 'CANCELLED') / 10000000, 3)) as revenueCollected,(SELECT (SELECT count(*) FROM eg_pt_property WHERE (createdtime/1000) <= (extract(epoch from NOW())) AND tenantid != 'pb.testing') + (SELECT count(*) FROM eg_tl_tradelicense WHERE (createdtime/1000) <= (extract(epoch from NOW())) AND tenantid != 'pb.testing')+ (SELECT count(*) FROM eg_fn_firenoc WHERE (createdtime/1000) <= (extract(epoch from NOW())) AND tenantid != 'pb.testing')) as servicesApplied, (select trunc((select sum((SELECT count(*) FROM eg_user WHERE (createddate <= NOW()) AND tenantid != 'pb.testing' AND type = 'CITIZEN'))/100000),3)) as noOfUsersRegistered, 'Week0' as day) UNION (SELECT (SELECT count(*) FROM ((SELECT DISTINCT tenantid FROM eg_pt_property WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing') UNION (SELECT DISTINCT tenantid FROM eg_tl_tradelicense WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing') UNION (SELECT DISTINCT tenantid FROM eg_fn_firenoc WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing') UNION (SELECT DISTINCT tenantid FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing')) AS tenants) as ulbCovered,(SELECT TRUNC((SELECT SUM(payment.totalamountpaid) FROM egcl_payment payment INNER JOIN egcl_paymentdetail paymentdetail ON payment.id = paymentdetail.paymentid INNER JOIN egcl_bill bill ON paymentdetail.billid =bill.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND payment.tenantid != 'pb.testing' AND payment.paymentstatus != 'CANCELLED') / 10000000, 3)) as revenueCollected,(SELECT (SELECT count(*) FROM eg_pt_property WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing') + (SELECT count(*) FROM eg_tl_tradelicense WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing')+(SELECT count(*) FROM eg_fn_firenocdetail WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing')) as servicesApplied, (select trunc((select sum((SELECT count(*) FROM eg_user WHERE createddate <= to_timestamp((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing' AND type = 'CITIZEN'))/100000),3)) as noOfUsersRegistered, 'Week1' as day) UNION (SELECT (SELECT count(*) FROM ((SELECT DISTINCT tenantid FROM eg_pt_property WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing') UNION (SELECT DISTINCT tenantid FROM eg_tl_tradelicense WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing') UNION (SELECT DISTINCT tenantid FROM eg_fn_firenocdetail WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing') UNION (SELECT DISTINCT tenantid FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing')) AS tenants) as ulbCovered,(SELECT TRUNC((SELECT SUM(payment.totalamountpaid) FROM egcl_payment payment INNER JOIN egcl_paymentdetail paymentdetail ON payment.id = paymentdetail.paymentid INNER JOIN egcl_bill bill ON paymentdetail.billid =bill.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND payment.tenantid != 'pb.testing' AND payment.paymentstatus != 'CANCELLED') / 10000000, 3)) as revenueCollected,(SELECT (SELECT count(*) FROM eg_pt_property WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing') + (SELECT count(*) FROM eg_tl_tradelicense WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing')) as servicesApplied, (select trunc((select sum((SELECT count(*) FROM eg_user WHERE createddate <= to_timestamp((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing' AND type = 'CITIZEN'))/100000),3)) as noOfUsersRegistered, 'Week2' as day) UNION (SELECT (SELECT count(*) FROM ((SELECT DISTINCT tenantid FROM eg_pt_property WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing') UNION (SELECT DISTINCT tenantid FROM eg_tl_tradelicense WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing') UNION (SELECT DISTINCT tenantid FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing')) AS tenants) as ulbCovered,(SELECT TRUNC(((SELECT SUM(payment.totalamountpaid) FROM egcl_payment payment INNER JOIN egcl_paymentdetail paymentdetail ON payment.id = paymentdetail.paymentid INNER JOIN egcl_bill bill ON paymentdetail.billid =bill.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND payment.tenantid != 'pb.testing' AND payment.paymentstatus != 'CANCELLED')) / 10000000, 3)) as revenueCollected,(SELECT (SELECT count(*) FROM eg_pt_property WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing') + (SELECT count(*) FROM eg_tl_tradelicense WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing')+(SELECT count(*) FROM eg_fn_firenocdetail WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing')) as servicesApplied, (select trunc((select sum((SELECT count(*) FROM eg_user WHERE createddate <= to_timestamp((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing' AND type = 'CITIZEN'))/100000),3)) as noOfUsersRegistered, 'Week3' as day) UNION (SELECT (SELECT count(*) FROM ((SELECT DISTINCT tenantid FROM eg_pt_property WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing') UNION (SELECT DISTINCT tenantid FROM eg_tl_tradelicense WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing') UNION (SELECT DISTINCT tenantid FROM eg_fn_firenoc WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing') UNION (SELECT DISTINCT tenantid FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing')) AS tenants) as ulbCovered,(SELECT TRUNC((SELECT SUM(payment.totalamountpaid) FROM egcl_payment payment INNER JOIN egcl_paymentdetail paymentdetail ON payment.id = paymentdetail.paymentid INNER JOIN egcl_bill bill ON paymentdetail.billid =bill.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND payment.tenantid != 'pb.testing' AND payment.paymentstatus != 'CANCELLED') / 10000000, 3)) as revenueCollected,(SELECT (SELECT count(*) FROM eg_pt_property WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing') + (SELECT count(*) FROM eg_tl_tradelicense WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing')+ (SELECT count(*) FROM eg_fn_firenocdetail WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing')) as servicesApplied, (select trunc((select sum((SELECT count(*) FROM eg_user WHERE createddate <= to_timestamp((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing' AND type = 'CITIZEN'))/100000),3)) as noOfUsersRegistered, 'Week4' as day) UNION (SELECT (SELECT count(*) FROM ((SELECT DISTINCT tenantid FROM eg_pt_property WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing') UNION (SELECT DISTINCT tenantid FROM eg_tl_tradelicense WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing')UNION (SELECT DISTINCT tenantid FROM eg_fn_firenocdetail WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing') UNION (SELECT DISTINCT tenantid FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing')) AS tenants) as ulbCovered,(SELECT TRUNC((SELECT SUM(payment.totalamountpaid) FROM egcl_payment payment INNER JOIN egcl_paymentdetail paymentdetail ON payment.id = paymentdetail.paymentid INNER JOIN egcl_bill bill ON paymentdetail.billid =bill.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND payment.tenantid != 'pb.testing' AND payment.paymentstatus != 'CANCELLED')/ 10000000, 3)) as revenueCollected, (SELECT (SELECT count(*) FROM eg_pt_property WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing') + (SELECT count(*) FROM eg_tl_tradelicense WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing')+ (SELECT count(*) FROM eg_fn_firenocdetail WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing')) as servicesApplied, (select trunc((select sum((SELECT count(*) FROM eg_user WHERE createddate <= to_timestamp((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing' AND type = 'CITIZEN'))/100000),3)) as noOfUsersRegistered, 'Week5' as day)) stateWideReports
     searchParams:
      condition: AND
      params:
      - name: intervalinsecs
        isMandatory: true
        jsonPath: $.searchCriteria.intervalinsecs
        
     output:
      jsonFormat: {"ResponseInfo": {}}
      outJsonPath: $.data
      responseInfoPath: $.ResponseInfo
      
      
      
   - name: pgrData
     query: 
      baseQuery: select array_to_json(array_agg(row_to_json(pgrReports))) from ((SELECT (SELECT count(DISTINCT tenantid) as ulbCovered FROM eg_pgr_service WHERE (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing'), CONCAT((count(*) / 1000), '.', MOD(count(*), 1000)) as totalComplaints, (SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing') != 0) THEN CONCAT(((SELECT count(*) FROM eg_pgr_service WHERE status = 'closed' OR status = 'resolved' AND (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing') * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing')), '%') ELSE '0%' END) as redressal), 'Week0' as day FROM eg_pgr_service WHERE (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing') UNION (SELECT (SELECT count(DISTINCT tenantid) as ulbCovered FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing'), CONCAT((count(*) / 1000), '.', MOD(count(*), 1000)) as totalComplaints, (SELECT (CASE WHEN (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing') != 0 THEN CONCAT(((SELECT count(*) FROM eg_pgr_service WHERE status = 'closed' OR status = 'resolved' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing') * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing')), '%') ELSE '0%' END) as redressal), 'Week1' as day FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing') UNION (SELECT (SELECT count(DISTINCT tenantid) as ulbCovered FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing'), CONCAT((count(*) / 1000), '.', MOD(count(*), 1000)) as totalComplaints, (SELECT (CASE WHEN (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing') != 0 THEN CONCAT(((SELECT count(*) FROM eg_pgr_service WHERE status = 'closed' OR status = 'resolved' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing') * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing')), '%') ELSE '0%' END) as redressal), 'Week2' as day FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing') UNION (SELECT (SELECT count(DISTINCT tenantid) as ulbCovered FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing'), CONCAT((count(*) / 1000), '.', MOD(count(*), 1000)) as totalComplaints, (SELECT (CASE WHEN (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing') != 0 THEN CONCAT(((SELECT count(*) FROM eg_pgr_service WHERE status = 'closed' OR status = 'resolved' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing') * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing')), '%') ELSE '0%' END) as redressal), 'Week3' as day FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing') UNION (SELECT (SELECT count(DISTINCT tenantid) as ulbCovered FROM eg_pgr_service  WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing'), CONCAT((count(*) / 1000), '.', MOD(count(*), 1000)) as totalComplaints, (SELECT (CASE WHEN (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing') != 0 THEN CONCAT(((SELECT count(*) FROM eg_pgr_service WHERE status = 'closed' OR status = 'resolved' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing') * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing')), '%') ELSE '0%' END) as redressal), 'Week4' as day FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing') UNION (SELECT (SELECT count(DISTINCT tenantid) as ulbCovered FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing'), CONCAT((count(*) / 1000), '.', MOD(count(*), 1000)) as totalComplaints, (SELECT (CASE WHEN (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing') != 0 THEN CONCAT(((SELECT count(*) FROM eg_pgr_service WHERE status = 'closed' OR status = 'resolved' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing') * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing')), '%') ELSE '0%' END) as redressal), 'Week5' as day FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing')) pgrReports
     searchParams:
      condition: AND
      params:
      - name: intervalinsecs
        isMandatory: true
        jsonPath: $.searchCriteria.intervalinsecs
  
     output:
      jsonFormat: {"ResponseInfo": {}}
      outJsonPath: $.data
      responseInfoPath: $.ResponseInfo      
      
      
   - name: pgrChannelData
     query: 
      baseQuery: select array_to_json(array_agg(row_to_json(pgrChannel))) from ((SELECT(SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'ivr' AND (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as ivr),(SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'web' AND (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as webapp),(SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'mobileapp' AND (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as mobileapp),(SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'whatsapp' AND (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as whatsapp),(SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'RB Bot' AND (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as rbbot),'Week0' as day FROM eg_pgr_service LIMIT 1) UNION (SELECT (SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'ivr' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal), (SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'web' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal),(SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'mobileapp' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal),(SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'whatsapp' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal),(SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'RB Bot' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal),'Week1' as day FROM eg_pgr_service LIMIT 1) UNION (SELECT (SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'ivr' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal), (SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'web' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal),(SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'mobileapp' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal), (SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'whatsapp' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal),(SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'RB Bot' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal), 'Week2' as day FROM eg_pgr_service LIMIT 1) UNION (SELECT (SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'ivr' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal), (SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'web' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal), (SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'mobileapp' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal), (SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'whatsapp' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal),(SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'RB Bot' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal), 'Week3' as day FROM eg_pgr_service LIMIT 1) UNION (SELECT (SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'ivr' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal), (SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'web' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal), (SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'mobileapp' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal), (SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'whatsapp' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal),(SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'RB Bot' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal), 'Week4' as day FROM eg_pgr_service LIMIT 1) UNION (SELECT (SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'ivr' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal), (SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'web' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal), (SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'mobileapp' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal), (SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'whatsapp' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal),(SELECT (CASE WHEN ((SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing') != 0) THEN CONCAT(round(((SELECT count(*) FROM eg_pgr_service WHERE source = 'RB Bot' AND (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing')::numeric * 100 / (SELECT count(*) FROM eg_pgr_service WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing'))::numeric, 2), '%') ELSE '0%' END) as redressal), 'Week5' as day FROM eg_pgr_service LIMIT 1)) pgrChannel

     searchParams:
      condition: AND
      params:
      - name: intervalinsecs
        isMandatory: true
        jsonPath: $.searchCriteria.intervalinsecs
  
     output:
      jsonFormat: {"ResponseInfo": {}}
      outJsonPath: $.data
      responseInfoPath: $.ResponseInfo
      
      
      
   - name: ptData
     query: 
      baseQuery: select array_to_json(array_agg(row_to_json(ptReports))) from ((SELECT (SELECT count(DISTINCT tenantid) as ulbCovered FROM eg_pt_property WHERE (createdtime/1000) <= (extract (epoch from NOW())) AND tenantid != 'pb.testing'),(select CONCAT((count(DISTINCT pt.propertyid) / 1000), '.', MOD(count(DISTINCT pt.propertyid), 1000)) as noofpropertiescreated FROM eg_pt_property pt where status='ACTIVE' AND tenantid != 'pb.testing'),(select TRUNC(SUM(payment.totalamountpaid) / 10000000, 3) as revenuecollected FROM egcl_paymentdetail paymentdetail INNER JOIN egcl_payment payment ON paymentdetail.paymentid =payment.id WHERE (paymentdetail.receiptdate/1000) <= (extract(epoch from NOW())) AND payment.tenantid != 'pb.testing' AND payment.paymentstatus != 'CANCELLED' AND paymentdetail.businessservice='PT'), 'Week0' as day) UNION (SELECT (SELECT count(DISTINCT tenantid) as ulbCovered FROM eg_pt_property WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tenantid != 'pb.testing'),(select CONCAT((count(DISTINCT pt.propertyid) / 1000), '.', MOD(count(DISTINCT pt.propertyid), 1000)) as noofpropertiescreated FROM eg_pt_property pt where (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND status='ACTIVE' AND tenantid != 'pb.testing') ,(select TRUNC(SUM(payment.totalamountpaid) / 10000000, 3) as revenuecollected FROM egcl_paymentdetail paymentdetail INNER JOIN egcl_payment payment ON paymentdetail.paymentid =payment.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND payment.tenantid != 'pb.testing'  AND payment.paymentstatus != 'CANCELLED' AND paymentdetail.businessservice='PT'), 'Week1' as day) UNION (SELECT (SELECT count(DISTINCT tenantid) as ulbCovered FROM eg_pt_property WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND tenantid != 'pb.testing'),(select CONCAT((count(DISTINCT pt.propertyid) / 1000), '.', MOD(count(DISTINCT pt.propertyid), 1000)) as noofpropertiescreated FROM eg_pt_property pt where (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND status='ACTIVE' AND tenantid != 'pb.testing'),(select TRUNC(SUM(payment.totalamountpaid) / 10000000, 3) as revenuecollected FROM egcl_paymentdetail paymentdetail INNER JOIN egcl_payment payment ON paymentdetail.paymentid =payment.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 2) AND payment.tenantid != 'pb.testing' AND payment.paymentstatus != 'CANCELLED' AND paymentdetail.businessservice='PT') ,'Week2') UNION (SELECT (SELECT count(DISTINCT tenantid) as ulbCovered FROM eg_pt_property WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND tenantid != 'pb.testing'),(select CONCAT((count(DISTINCT pt.propertyid) / 1000), '.', MOD(count(DISTINCT pt.propertyid), 1000)) as noofpropertiescreated FROM eg_pt_property pt where (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 *3 ) AND status='ACTIVE' AND tenantid != 'pb.testing') ,(select TRUNC(SUM(payment.totalamountpaid) / 10000000, 3) as revenuecollected FROM egcl_paymentdetail paymentdetail INNER JOIN egcl_payment payment ON paymentdetail.paymentid =payment.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 3) AND payment.tenantid != 'pb.testing' AND payment.paymentstatus != 'CANCELLED' AND paymentdetail.businessservice='PT'),'Week3' as day) UNION (SELECT (SELECT count(DISTINCT tenantid) as ulbCovered FROM eg_pt_property WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND tenantid != 'pb.testing'), (select CONCAT((count(DISTINCT pt.propertyid) / 1000), '.', MOD(count(DISTINCT pt.propertyid), 1000)) as noofpropertiescreated FROM eg_pt_property pt where (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND status='ACTIVE' AND tenantid != 'pb.testing'),(select TRUNC(SUM(payment.totalamountpaid) / 10000000, 3) as revenuecollected FROM egcl_paymentdetail paymentdetail INNER JOIN egcl_payment payment ON paymentdetail.paymentid =payment.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 4) AND payment.tenantid != 'pb.testing' AND payment.paymentstatus != 'CANCELLED' AND paymentdetail.businessservice='PT'), 'Week4' as day) UNION (SELECT (SELECT count(DISTINCT tenantid) as ulbCovered FROM eg_pt_property WHERE (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND tenantid != 'pb.testing'), (select CONCAT((count(DISTINCT pt.propertyid) / 1000), '.', MOD(count(DISTINCT pt.propertyid), 1000)) as noofpropertiescreated FROM eg_pt_property pt where (createdtime/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND status='ACTIVE' AND tenantid != 'pb.testing'),(select TRUNC(SUM(payment.totalamountpaid) / 10000000, 3) as revenuecollected FROM egcl_paymentdetail paymentdetail INNER JOIN egcl_payment payment ON paymentdetail.paymentid =payment.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800 * 5) AND payment.tenantid != 'pb.testing' AND payment.paymentstatus != 'CANCELLED' AND paymentdetail.businessservice='PT'), 'Week5' as day)) ptReports
     searchParams:
      condition: AND
      params:
      - name: intervalinsecs
        isMandatory: true
        jsonPath: $.searchCriteria.intervalinsecs
  
     output:
      jsonFormat: {"ResponseInfo": {}}
      outJsonPath: $.data
      responseInfoPath: $.ResponseInfo
      
      
      
   - name: tlData
     query: 
      baseQuery: select array_to_json(array_agg(row_to_json(tlReports))) from (SELECT count(DISTINCT tl.tenantid) as ulbCovered , CONCAT((count(*) / 1000), '.', MOD(count(*), 1000)) as licenseIssued,TRUNC(SUM(payment.totalamountpaid) / 10000000, 3) as revenuecollected, 'Week0' as day FROM eg_tl_tradelicense as tl INNER JOIN egcl_bill bill ON tl.applicationnumber = bill.consumercode INNER JOIN egcl_paymentdetail paymentdetail ON bill.id = paymentdetail.billid INNER JOIN egcl_payment payment ON paymentdetail.paymentid =payment.id WHERE (paymentdetail.receiptdate/1000) <= (extract(epoch from NOW())) AND tl.tenantid != 'pb.testing' AND payment.paymentstatus != 'CANCELLED'  AND tl.status='APPROVED' UNION SELECT  count(DISTINCT tl.tenantid) as ulbCovered , CONCAT((count(*) / 1000), '.', MOD(count(*), 1000)) as licenseIssued, TRUNC(SUM(payment.totalamountpaid) / 10000000, 3) as revenuecollected,'Week1' as day FROM eg_tl_tradelicense tl INNER JOIN egcl_bill bill ON tl.applicationnumber = bill.consumercode INNER JOIN egcl_paymentdetail paymentdetail ON bill.id = paymentdetail.billid INNER JOIN egcl_payment payment ON paymentdetail.paymentid =payment.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND tl.tenantid != 'pb.testing' AND payment.paymentstatus != 'CANCELLED'  AND tl.status='APPROVED' UNION SELECT  count(DISTINCT tl.tenantid) as ulbCovered , CONCAT((count(*) / 1000), '.', MOD(count(*), 1000)) as licenseIssued,TRUNC(SUM(payment.totalamountpaid) / 10000000, 3) as revenuecollected, 'Week2' as day FROM eg_tl_tradelicense tl INNER JOIN egcl_bill bill ON tl.applicationnumber = bill.consumercode INNER JOIN egcl_paymentdetail paymentdetail ON bill.id = paymentdetail.billid INNER JOIN egcl_payment payment ON paymentdetail.paymentid =payment.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800*2) AND tl.tenantid != 'pb.testing' AND payment.paymentstatus != 'CANCELLED' AND tl.status='APPROVED' UNION SELECT  count(DISTINCT tl.tenantid) as ulbCovered , CONCAT((count(*) / 1000), '.', MOD(count(*), 1000)) as licenseIssued,TRUNC(SUM(payment.totalamountpaid) / 10000000, 3) as revenuecollected, 'Week3' as day FROM eg_tl_tradelicense tl INNER JOIN egcl_bill bill ON tl.applicationnumber = bill.consumercode INNER JOIN egcl_paymentdetail paymentdetail ON bill.id = paymentdetail.billid INNER JOIN egcl_payment payment ON paymentdetail.paymentid =payment.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800*3) AND tl.tenantid != 'pb.testing' AND payment.paymentstatus != 'CANCELLED' AND tl.status='APPROVED' UNION SELECT  count(DISTINCT tl.tenantid) as ulbCovered , CONCAT((count(*) / 1000), '.', MOD(count(*), 1000)) as  licenseIssued,TRUNC(SUM(payment.totalamountpaid) / 10000000, 3) as revenuecollected, 'Week4' as day FROM eg_tl_tradelicense tl INNER JOIN egcl_bill bill ON tl.applicationnumber = bill.consumercode INNER JOIN egcl_paymentdetail paymentdetail ON bill.id = paymentdetail.billid INNER JOIN egcl_payment payment ON paymentdetail.paymentid =payment.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800*4) AND tl.tenantid != 'pb.testing' AND payment.paymentstatus != 'CANCELLED' AND tl.status='APPROVED' UNION SELECT  count(DISTINCT tl.tenantid) as ulbCovered , CONCAT((count(*) / 1000), '.', MOD(count(*), 1000)) as licenseIssued,TRUNC(SUM(payment.totalamountpaid) / 10000000, 3) as revenuecollected, 'Week5' as day FROM eg_tl_tradelicense tl INNER JOIN egcl_bill bill ON tl.applicationnumber = bill.consumercode INNER JOIN egcl_paymentdetail paymentdetail ON bill.id = paymentdetail.billid INNER JOIN egcl_payment payment ON paymentdetail.paymentid =payment.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800*5) AND tl.tenantid != 'pb.testing' AND payment.paymentstatus != 'CANCELLED' AND tl.status='APPROVED')   tlReports

     searchParams:
      condition: AND
      params:
      - name: intervalinsecs
        isMandatory: true
        jsonPath: $.searchCriteria.intervalinsecs
  
     output:
      jsonFormat: {"ResponseInfo": {}}
      outJsonPath: $.data
      responseInfoPath: $.ResponseInfo
      
      
      
   - name: miscCollections
     query: 
      baseQuery: select array_to_json(array_agg(row_to_json(misccollections))) from ((SELECT TRUNC(CONCAT((count(*) / 100000), '.', MOD(count(*), 100000))::decimal,3) as receiptscreated, TRUNC(SUM(payment.totalamountpaid) / 10000000, 3) as revenuecollected, 'Week0' as day FROM egcl_payment payment LEFT JOIN egcl_paymentdetail paymentdetail ON payment.id = paymentdetail.paymentid  $where AND (paymentdetail.receiptdate/1000) <= (extract(epoch from NOW()))) UNION (SELECT TRUNC(CONCAT((count(*) / 100000), '.', MOD(count(*), 100000))::decimal,3) as receiptscreated, TRUNC(SUM(payment.totalamountpaid) / 10000000, 3) as revenuecollected, 'Week1' as day FROM egcl_payment payment LEFT JOIN egcl_paymentdetail paymentdetail ON payment.id = paymentdetail.paymentid  $where AND (paymentdetail.receiptdate/1000) <= ((extract(epoch from NOW())) - 604800)) UNION (SELECT TRUNC(CONCAT((count(*) / 100000), '.', MOD(count(*), 100000))::decimal,3) as receiptscreated, TRUNC(SUM(payment.totalamountpaid) / 10000000, 3) as revenuecollected, 'Week2' as day FROM egcl_payment payment LEFT JOIN egcl_paymentdetail paymentdetail ON payment.id = paymentdetail.paymentid  $where AND (paymentdetail.receiptdate/1000) <= ((extract(epoch from NOW())) - 604800 * 2)) UNION (SELECT TRUNC(CONCAT((count(*) / 100000), '.', MOD(count(*), 100000))::decimal,3) as receiptscreated, TRUNC(SUM(payment.totalamountpaid) / 10000000, 3) as revenuecollected, 'Week3' as day FROM egcl_payment payment LEFT JOIN egcl_paymentdetail paymentdetail ON payment.id = paymentdetail.paymentid  $where AND (paymentdetail.receiptdate/1000) <= ((extract(epoch from NOW())) - 604800 * 3)) UNION (SELECT TRUNC(CONCAT((count(*) / 100000), '.', MOD(count(*), 100000))::decimal,3) as receiptscreated, TRUNC(SUM(payment.totalamountpaid) / 10000000, 3) as revenuecollected, 'Week4' as day FROM egcl_payment payment LEFT JOIN egcl_paymentdetail paymentdetail ON payment.id = paymentdetail.paymentid  $where AND (paymentdetail.receiptdate/1000) <= ((extract(epoch from NOW())) - 604800 * 4)) UNION (SELECT TRUNC(CONCAT((count(*) / 100000), '.', MOD(count(*), 100000))::decimal,3) as receiptscreated, TRUNC(SUM(payment.totalamountpaid) / 10000000, 3) as revenuecollected, 'Week5' as day FROM egcl_payment payment LEFT JOIN egcl_paymentdetail paymentdetail ON payment.id = paymentdetail.paymentid  $where AND (paymentdetail.receiptdate/1000) <= ((extract(epoch from NOW())) - 604800 * 5))) misccollections
     searchParams:
      condition: AND
      params:
      - name: payment.tenantid
        isMandatory: true
        operator: NE
        jsonPath: $.searchCriteria.ignoreTenant
      - name: paymentdetail.businessservice
        isMandatory: false
        operator: IN
        jsonPath: $.searchCriteria.taxHeads
      - name: paymentdetail.businessservice
        isMandatory: false
        operator: NOT IN
        jsonPath: $.searchCriteria.ignoreTaxHeads
      - name: payment.paymentstatus
        isMandatory: true
        operator: NE
        jsonPath: $.searchCriteria.ignoreStatus
  
     output:
      jsonFormat: {"ResponseInfo": {}}
      outJsonPath: $.data
      responseInfoPath: $.ResponseInfo 

   - name: firenocData
     query: 
      baseQuery: select array_to_json(array_agg(row_to_json(firenocReports))) from (SELECT count(DISTINCT fn.tenantid) as ulbCovered , count(*) as certificatesIssued,COALESCE(TRUNC(SUM(payment.totalamountpaid) / 10000000, 3),0) as revenuecollected, 'Week0' as day FROM  eg_fn_firenocdetail as fn  INNER JOIN egcl_bill bill ON fn.applicationnumber = bill.consumercode INNER JOIN egcl_paymentdetail paymentdetail ON bill.id = paymentdetail.billid INNER JOIN egcl_payment payment ON paymentdetail.paymentid =payment.id WHERE (paymentdetail.receiptdate/1000) <= (extract(epoch from NOW())) AND fn.tenantid != 'pb.testing' AND payment.paymentstatus!='CANCELLED'  AND fn.status='APPROVED' UNION SELECT  count(DISTINCT fn.tenantid) as ulbCovered , count(*) as certficatesIssued, COALESCE(TRUNC(SUM(payment.totalamountpaid) / 10000000, 3),0) as revenuecollected,'Week1' as day FROM eg_fn_firenocdetail fn  INNER JOIN egcl_bill bill ON fn.applicationnumber = bill.consumercode INNER JOIN egcl_paymentdetail paymentdetail ON bill.id = paymentdetail.billid INNER JOIN egcl_payment payment ON paymentdetail.paymentid =payment.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800) AND fn.tenantid != 'pb.testing' AND payment.paymentstatus!='CANCELLED'  AND fn.status='APPROVED' UNION SELECT  count(DISTINCT fn.tenantid) as ulbCovered , count(*) as certficatesIssued,COALESCE(TRUNC(SUM(payment.totalamountpaid) / 10000000, 3),0) as revenuecollected, 'Week2' as day FROM eg_fn_firenocdetail fn INNER JOIN egcl_bill bill ON fn.applicationnumber = bill.consumercode INNER JOIN egcl_paymentdetail paymentdetail ON bill.id = paymentdetail.billid INNER JOIN egcl_payment payment ON paymentdetail.paymentid =payment.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800*2) AND fn.tenantid != 'pb.testing' AND payment.paymentstatus!='CANCELLED'  AND fn.status='APPROVED' UNION SELECT  count(DISTINCT fn.tenantid) as ulbCovered , count(*) as certificatesIssued,COALESCE(TRUNC(SUM(payment.totalamountpaid) / 10000000, 3),0) as revenuecollected, 'Week3' as day FROM eg_fn_firenocdetail fn INNER JOIN egcl_bill bill ON fn.applicationnumber = bill.consumercode INNER JOIN egcl_paymentdetail paymentdetail ON bill.id = paymentdetail.billid INNER JOIN egcl_payment payment ON paymentdetail.paymentid =payment.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800*3) AND fn.tenantid != 'pb.testing' AND payment.paymentstatus!='CANCELLED'  AND fn.status='APPROVED' UNION SELECT  count(DISTINCT fn.tenantid) as ulbCovered , count(*) as certficatesIssued,COALESCE(TRUNC(SUM(payment.totalamountpaid) / 10000000, 3),0) as revenuecollected, 'Week4' as day FROM eg_fn_firenocdetail fn INNER JOIN egcl_bill bill ON fn.applicationnumber = bill.consumercode INNER JOIN egcl_paymentdetail paymentdetail ON bill.id = paymentdetail.billid INNER JOIN egcl_payment payment ON paymentdetail.paymentid =payment.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800*4) AND fn.tenantid != 'pb.testing' AND payment.paymentstatus!='CANCELLED'  AND fn.status='APPROVED' UNION SELECT  count(DISTINCT fn.tenantid) as ulbCovered , count(*) as certficatesIssued,COALESCE(TRUNC(SUM(payment.totalamountpaid) / 10000000, 3),0) as revenuecollected, 'Week5' as day FROM eg_fn_firenocdetail fn INNER JOIN egcl_bill bill ON fn.applicationnumber = bill.consumercode INNER JOIN egcl_paymentdetail paymentdetail ON bill.id = paymentdetail.billid INNER JOIN egcl_payment payment ON paymentdetail.paymentid =payment.id WHERE (paymentdetail.receiptdate/1000) <= ((extract (epoch from (to_timestamp(CONCAT(CURRENT_DATE + integer '1'), 'YYYY-MM-DD H24:MI:SS')))) - 604800*5) AND fn.tenantid != 'pb.testing' AND payment.paymentstatus!='CANCELLED'  AND fn.status='APPROVED')   firenocReports
     searchParams:
      condition: AND
      params:
      - name: intervalinsecs
        isMandatory: true
        jsonPath: $.searchCriteria.intervalinsecs
  
     output:
      jsonFormat: {"ResponseInfo": {}}
      outJsonPath: $.data
      responseInfoPath: $.ResponseInfo   
